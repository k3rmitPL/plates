<!doctype html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="description" content="Quiz z tablic rejstracyjnych">
    <meta name="keywords" content="tablice rejestracyjne">
    <meta name="author" content="Bartek Lisok">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
      * {
        box-sizing: border-box;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
      }
      body, html {
        margin: 0;
        padding: 0;
        font-family: Arial;
      }
      #content {
        height: 100vh;
        padding-bottom: 10vh;
        font-size: 10vw;
        text-align: center;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        background: #eee;
        perspective: 700px;
        display: flex;
      }

      #plate {
        margin: 0 auto;
        padding-left: 5vw;
        border-radius: 1vw;
        background: #fff;
        border: .5vw solid #000;
        display: inline-block;
        position: relative;
      }
      #plate .sidebar {
        left: 0;
        top: 0;
        height: 100%;
        padding: 1vw .6vw;
        vertical-align: bottom;
        font-size: 3vw;
        color: #fff;
        align-items: flex-end;
        background: #003a9e;
        display: flex;
        position: absolute;
      }
      #plate .number {
        padding: 0 2vw;
        line-height: 11vw;
      }
      #answer {
        margin: 5vw;
        height: 14vw;
        font-size: 5vw;
        line-height: 7vw;
        transform: rotateY(90deg);
        /* transform-origin: 0 0; */
        backface-visibility: hidden;
        opacity: 0;

      }
      #answer.visible {
        transform: rotateY(0deg);
        opacity: 1;
        transition: 1s;
      }


      #next-plate {
        top: 0;
        right: 0;
        width: 100%;
        height: 10vh;
        color: #fff;
        font-size: 3vh;
        background: #085c98;
        position: absolute;
      }


      #show-answer {
        width: 100%;
        bottom: 0;
        height: 10vh;
        color: #fff;
        font-size: 3vh;
        background: #08984a;
        position: absolute;
      }

      #counter {
        margin: 0 2vw 2vw;
        font-size: 3.5vw;
        color: #888;
      }
    </style>
  </head>
  <body>
    <div id="content">
      <div id="counter"></div>
      <div id="plate">
        <span class="sidebar">PL</span>
        <span class="number"></span>
      </div>
      <div id="answer">
      </div>
      <button id="show-answer">Pokaż odpowiedź</button>
      <button id="next-plate">Następna tablica</button>
    </div>

    <script>
      var plates_mapping = {
        "mazowieckie": {
          "WG": "Garwolin",
          "WF": "Warszawa-praga pd.",
          "WE": "Warszawa-mokotów",
          "WD": "Warszawa-bielany",
          "WB": "Warszawa-bemowo",
          "WA": "Warszawa-białołęka",
          "WL": "Legionowo",
          "WK": "Warszawa-ursus",
          "WJ": "Warszawa-targówek",
          "WI": "Warszawa-śródmieście",
          "WH": "Warszawa-praga pn.",
          "WBR": "Białobrzegi",
          "WLS": "Łosice",
          "WLI": "Lipsko",
          "WPY": "Przysucha",
          "WND": "Nowy dwór mazowiecki",
          "WPU": "Pułtusk",
          "WPR": "Pruszków",
          "WPL": "Płock powiat",
          "WPN": "Płońsk",
          "WPI": "Piaseczno",
          "WRA": "Radom powiat",
          "WGM": "Grodzisk",
          "WOT": "Otwock",
          "WOS": "Ostrołęka powiat",
          "WOR": "Ostrów mazowiecka",
          "WGS": "Gostynin",
          "WML": "Mława",
          "WCI": "Ciechanów",
          "WMA": "Maków mazowiecki",
          "WPZ": "Przasnysz",
          "WKZ": "Kozienice",
          "WGR": "Grójec"
        },
        "pomorskie": {
          "GS": "Słupsk miasto",
          "GCH": "Chojnice",
          "GKS": "Kościerzyna",
          "GKW": "Kwidzyn",
          "GDA": "Pruszcz gdański",
          "GD": "Gdańsk",
          "GA": "Gdynia",
          "GKA": "Kartuzy",
          "GCZ": "Człuchów",
          "GBY": "Bytów"
        },
        "zachodniopomorskie": {
          "ZKL": "Kołobrzeg",
          "ZGY": "Gryfice",
          "ZKO": "Koszalin powiat",
          "ZK": "Koszalin miasto",
          "ZGR": "Gryfino",
          "ZCH": "Choszczno",
          "ZKA": "Kamień pomorski",
          "ZBI": "Białogard",
          "ZDR": "Drawsko",
          "ZGL": "Goleniów",
          "ZS": "Szczecin"
        },
        "kujawsko-pomorskie": {
          "CGR": "Grudziądz powiat",
          "CLI": "Lipno",
          "CB": "Bydgoszcz",
          "CG": "Grudziądz miasto",
          "CGD": "Golub-dobrzyń",
          "CIN": "Inowrocław",
          "CBR": "Brodnica",
          "CCH": "Chełmno",
          "CAL": "Aleksandrów kujawski",
          "CBY": "Bydgoszcz powiat",
          "CW": "Włocławek miasto",
          "CT": "Toruń"
        },
        "małopolskie": {
          "KGR": "Gorlice",
          "KBC": "Bochnia",
          "KLI": "Limanowa",
          "KCH": "Chrzanów",
          "KMI": "Miechów",
          "KN": "Nowy sącz miasto",
          "KR": "Kraków",
          "KDA": "Dąbrowa tarnowska",
          "KT": "Tarnów miasto",
          "KBR": "Brzesko",
          "KMY": "Myślenice"
        },
        "opolskie": {
          "OKR": "Krapkowice",
          "OK": "Kędzierzyn koźle",
          "OB": "Brzeg",
          "OGL": "Głubczyce",
          "OKL": "Kluczbork",
          "OP": "Opole"
        },
        "świętokrzyskie": {
          "TJE": "Jędrzejów",
          "TKA": "Kazimierza wielka",
          "TKN": "Końskie",
          "TBU": "Busko",
          "TKI": "Kielce powiat",
          "TK": "Kielce",
          "TLW": "Włoszczowa"
        },
        "wielkopolskie": {
          "PKR": "Krotoszyn",
          "PKS": "Kościan",
          "PP": "Piła",
          "PKN": "Konin powiat",
          "PZ": "Poznań powiat",
          "PGO": "Grodzisk wlkp.",
          "PJA": "Jarocin",
          "PCT": "Czarnków",
          "PKO": "Konin miasto",
          "PGN": "Gniezno",
          "PCH": "Chodzieź",
          "PKA": "Kalisz powiat",
          "PGS": "Gostyń",
          "PKE": "Kępno",
          "PK": "Kalisz miasto",
          "PN": "Konin miasto",
          "PO": "Poznań",
          "PL": "Leszno miasto",
          "PKL": "Koło"
        },
        "łódzkie": {
          "EL": "Łódź",
          "ELW": "Łódź powiat",
          "EBE": "Bełchatów",
          "ELC": "Łowicz",
          "ELA": "Łask",
          "ELE": "Łęczyca",
          "EOP": "Opoczno",
          "EBR": "Brzeziny",
          "EKU": "Kutno",
          "EP": "Piotrków tryb. miasto",
          "ES": "Skierniewice miasto",
          "EPA": "Pabianice"
        },
        "śląskie": {
          "SZ": "Zabrze",
          "SY": "Bytom",
          "SR": "Rybnik miasto",
          "SBE": "Będzin",
          "SW": "świętochłowice",
          "ST": "Tychy miasto",
          "SK": "Katowice",
          "SJ": "Jaworzno",
          "SI": "Siemianowice śląskie",
          "SH": "Chorzów",
          "SO": "Sosnowiec",
          "SM": "Mysłowice",
          "SL": "Ruda śląska",
          "SC": "Częstochowa miasto",
          "SB": "Bielsko-biała miasto",
          "SBI": "Bielsko-biała powiat",
          "SG": "Gliwice miasto",
          "SBL": "Tychy powiat",
          "SD": "Dąbrowa górnicza"
        },
        "lubelskie": {
          "LB": "Biała podlaska miasto",
          "LC": "Chełm miasto",
          "LJA": "Janów lubelski",
          "LKR": "Kraśnik",
          "LKS": "Krasnystaw",
          "LU": "Lublin",
          "LHR": "Hrubieszów",
          "LBI": "Biała podlaska powiat",
          "LLB": "Lubartów",
          "LZ": "Zamość miasto",
          "LBL": "Biłgoraj",
          "LCH": "Chełm powiat"
        },
        "warmińsko-mazurskie": {
          "NEL": "Ełk",
          "NKE": "Kętrzyn",
          "NIL": "Iława",
          "NO": "Olsztyn",
          "NBR": "Braniewo",
          "NGO": "Gołdap",
          "NEB": "Elbląg powiat",
          "NE": "Elbląg miasto",
          "NGI": "Giźycko",
          "NDZ": "Działdowo",
          "NBA": "Bartoszyce"
        },
        "podkarpackie": {
          "RT": "Tarnobrzeg miasto",
          "RP": "Przemyśl miasto",
          "RJA": "Jarosław",
          "RKR": "Krosno powiat",
          "RLE": "Leźajsk",
          "RLA": "Łańcut",
          "RBR": "Brzozów",
          "RZ": "Rzeszów",
          "RDE": "Dębica",
          "RBI": "Ustrzyki dolne",
          "RKL": "Kolbuszowa",
          "RJS": "Jasło",
          "RK": "Krosno miasto"
        },
        "podlaskie": {
          "BAU": "Augustów",
          "BBI": "Bielsk podlaski",
          "BL": "Łomźa miasto",
          "BKL": "Kolno",
          "BI": "Białystok",
          "BIA": "Białystok powiat",
          "BHA": "Hajnówka",
          "BGR": "Grajewo",
          "BS": "Suwałki miasto"
        },
        "lubuskie": {
          "FNW": "Nowa sól",
          "FSD": "Strzelce krajeńskie",
          "FZ": "Zielona góra",
          "FGW": "Gorzów wlkp. powiat",
          "FMI": "Międzyrzecz",
          "FKR": "Krosno odrzańskie",
          "FG": "Gorzów wlkp."
        },
        "dolnośląskie": {
          "DDZ": "Dzierźoniów",
          "DL": "Legnica miasto",
          "DJ": "Jelenia góra miasto",
          "DBL": "Bolesławiec",
          "DLE": "Legnica powiat",
          "DLB": "Lubań",
          "DBA": "Wałbrzych powiat",
          "DB": "Wałbrzych miasto",
          "DGL": "Głogów",
          "DGR": "Góra",
          "DJE": "Jelenia góra powiat",
          "DKA": "Kamienna góra",
          "DW": "WrocŁaw",
          "DKL": "Kłodzko",
          "DJA": "Jawor"
        }
      };




      var filtered_plates = filterPlates();
      var total_count = 0;
      for (var i = 0; i < Object.keys(plates_mapping).length; i++) {
        for (var l = 0; l < Object.keys(plates_mapping[Object.keys(plates_mapping)[i]]).length; l++) {
          total_count += 1;
        }
      }
      var seen_count = 0;

      function generatePlate() {
        var voivodeships = Object.keys(filtered_plates);
        var voivodeship = voivodeships[Math.floor(Math.random() * voivodeships.length)];
        var codes = Object.keys(filtered_plates[voivodeship]);
        var city_code = codes[Math.floor(Math.random() * codes.length)];
        var number = Math.floor(Math.random() * 89999) + 10000
        document.querySelector('#plate .number').innerText = city_code + ' ' + number;

        var answer = document.getElementById('answer');
        answer.innerText = voivodeship + ', ' + filtered_plates[voivodeship][city_code];

        addPlateToSeen(voivodeship, city_code);
      }

      function filterPlates() {
        var filtered_plates = {};//JSON.parse(JSON.stringify(plates_mapping));
        var c = getCookie('seenCities');

        if (!c) {
          console.log("no data");
          return plates_mapping;
        }
        var seenCities = JSON.parse(c);
        console.log(seenCities);
        updateCounter(seenCities.length);
        if (seenCities.length > 0) {
          var voivodeships_to_delete = [];
          for (var i = 0; i < Object.keys(plates_mapping).length; i++) {
            var voivodeship = Object.keys(plates_mapping)[i];
            for (var l = 0; l < Object.keys(plates_mapping[voivodeship]).length; l++) {
              var city_code = Object.keys(plates_mapping[voivodeship])[l];
              console.log(city_code + " : " + seenCities.indexOf(city_code));
              if (seenCities.indexOf(city_code) == -1) {
                if (Object.keys(filtered_plates).indexOf(voivodeship) == -1) {
                  filtered_plates[voivodeship] = {};
                }
                filtered_plates[voivodeship][city_code] = plates_mapping[voivodeship][city_code];
              }
            }
          }
        } else {
          filtered_plates = JSON.parse(JSON.stringify(plates_mapping));
        }

        if (Object.keys(filtered_plates).length == 0) {
          setCookie('seenCities', '[]', 360);
          updateCounter(0);
          console.log("Reset");
          return filterPlates();
        }

        return filtered_plates;
      }

      function updateCounter(new_seen_count) {
        seen_count = new_seen_count;
        var counter = document.getElementById('counter');
        counter.innerText = seen_count + ' / ' + total_count + ', pozostało: ' + (total_count - seen_count);
      }

      function addPlateToSeen(voivodeship, city_code) {
        var c = getCookie('seenCities');
        if (!c) {
          c = '[]';
        }
        var seenCities = JSON.parse(c);
        seenCities.push(city_code);
        setCookie('seenCities', JSON.stringify(seenCities), 360);
        updateCounter(seenCities.length);
        console.log("Remove city: " + filtered_plates[voivodeship][city_code]);
        delete filtered_plates[voivodeship][city_code];
        if (Object.keys(filtered_plates[voivodeship]).length == 0) {
          console.log("Remove voivodeship: " + voivodeship)
          delete filtered_plates[voivodeship];
        }

        if (Object.keys(filtered_plates).length == 0) {
          setCookie('seenCities', '[]', 360);
          updateCounter(0);
          console.log("Reset");
          filtered_plates = filterPlates();
        }
      }

      function getCookie(cname) {
        var name = cname + "=";
        var decodedCookie = decodeURIComponent(document.cookie);
        var ca = decodedCookie.split(';');
        for(var i = 0; i <ca.length; i++) {
          var c = ca[i];
          while (c.charAt(0) == ' ') {
            c = c.substring(1);
          }
          if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
          }
        }
        return "";
      }

      function setCookie(cname, cvalue, exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays*24*60*60*1000));
        var expires = "expires="+ d.toUTCString();
        document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
      }

      var answerBtn = document.getElementById("show-answer");
      answerBtn.onclick = function() {
        var answer = document.getElementById('answer');
        answer.className = "visible";
      }

      var nextBtn = document.getElementById("next-plate");
      nextBtn.onclick = function() {
        var answer = document.getElementById('answer');
        answer.className = "";
        generatePlate();
      }

      generatePlate();
    </script>
  </body>
</html>
